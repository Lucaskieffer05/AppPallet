<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AppPallet.Views.IngresoEgresoView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:AppPallet.Converters"
    xmlns:dg="clr-namespace:Maui.DataGrid;assembly=Maui.DataGrid"
    xmlns:fa="clr-namespace:UraniumUI.Icons.FontAwesome;assembly=UraniumUI.Icons.FontAwesome"
    xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
    xmlns:models="clr-namespace:AppPallet.Models"
    xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
    xmlns:viewModels="clr-namespace:AppPallet.ViewModels"
    Title="INGRESO Y EGRESO"
    x:DataType="viewModels:IngresoEgresoViewModel"
    Shell.NavBarIsVisible="False">


    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:ColorByValueConverter x:Key="ColorByValueConverter" />

            <Style x:Key="CardStyle" TargetType="Border">
                <Setter Property="BackgroundColor" Value="White" />
                <Setter Property="Stroke" Value="#E0E0E0" />
                <Setter Property="StrokeShape" Value="RoundRectangle 16" />
                <Setter Property="Padding" Value="7" />
            </Style>

        </ResourceDictionary>
    </ContentPage.Resources>


    <Grid RowDefinitions="Auto,*">

        <!--  Header  -->
        <Border Grid.Row="0" Stroke="Black">
            <Grid BackgroundColor="#374151" ColumnDefinitions="0.3*,Auto,Auto,0.1*">

                <Label
                    Grid.Column="0"
                    Margin="10,0,0,0"
                    FontAttributes="Bold"
                    FontSize="23"
                    HorizontalOptions="Start"
                    LineBreakMode="TailTruncation"
                    Text="INGRESOS Y EGRESOS"
                    TextColor="#F6F1EB"
                    VerticalOptions="Center" />

                <HorizontalStackLayout Grid.Column="1" HorizontalOptions="Center">
                    <Label
                        FontSize="15"
                        Text="Filtrar por mes:"
                        TextColor="White"
                        VerticalOptions="Center" />

                    <material:PickerField
                        x:Name="MesPicker"
                        Padding="5"
                        AccentColor="White"
                        BorderColor="White"
                        FontSize="12"
                        InputBackgroundColor="#F6F1EB"
                        ItemsSource="{Binding Meses}"
                        SelectedIndex="{Binding MesIngresado, Mode=TwoWay}"
                        TextColor="White" />

                    <material:PickerField
                        x:Name="AñoPicker"
                        Padding="5"
                        AccentColor="White"
                        BorderColor="White"
                        FontSize="12"
                        InputBackgroundColor="#F6F1EB"
                        ItemsSource="{Binding Años}"
                        SelectedItem="{Binding AñoIngresado, Mode=TwoWay}"
                        TextColor="White" />



                </HorizontalStackLayout>
            </Grid>
        </Border>

        <!--  Resumen  -->
        <ScrollView Grid.Row="1">
            <Grid RowDefinitions="Auto,Auto,30">
                <Border
                    Grid.Row="0"
                    Margin="30"
                    Stroke="Transparent">
                    <Border Style="{StaticResource CardStyle}" WidthRequest="820">

                        <VerticalStackLayout>
                            <Label
                                FontAttributes="Bold"
                                FontSize="15"
                                HorizontalOptions="Center"
                                Text="Resumen del Mes:"
                                TextColor="Black" />
                            <HorizontalStackLayout Spacing="10">
                                <Label
                                    Margin="20,0,0,0"
                                    FontAttributes="Bold"
                                    FontSize="12"
                                    Text="Diferencia neta entre Egresos e Ingresos:"
                                    TextColor="Black"
                                    VerticalOptions="Center" />
                                <Label
                                    FontAttributes="Bold"
                                    FontSize="12"
                                    Text="{Binding Neto, StringFormat='${0:N2}'}"
                                    TextColor="{Binding Neto, Converter={StaticResource ColorByValueConverter}}"
                                    VerticalOptions="Center" />
                                <Label
                                    Margin="20,0,0,0"
                                    FontAttributes="Bold"
                                    FontSize="12"
                                    Text="Diferencia neta mas IVA:"
                                    TextColor="Black"
                                    VerticalOptions="Center" />
                                <Label
                                    FontAttributes="Bold"
                                    FontSize="12"
                                    Text="{Binding NetoMasIVA, StringFormat='${0:N2}'}"
                                    TextColor="{Binding NetoMasIVA, Converter={StaticResource ColorByValueConverter}}"
                                    VerticalOptions="Center" />
                                <Label
                                    Margin="20,0,0,0"
                                    FontAttributes="Bold"
                                    FontSize="12"
                                    Text="Neto IVA:"
                                    TextColor="Black"
                                    VerticalOptions="Center" />
                                <Label
                                    FontAttributes="Bold"
                                    FontSize="12"
                                    Text="{Binding NetoIVA, StringFormat='${0:N2}'}"
                                    TextColor="{Binding NetoIVA, Converter={StaticResource ColorByValueConverter}}"
                                    VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                    </Border>
                </Border>


                <!--  Ingresos y Egresos  -->

                <Grid
                    Grid.Row="1"
                    ColumnDefinitions="0.02*,*,*,0.02*"
                    RowDefinitions="Auto,*">

                    <Label
                        Grid.Row="0"
                        Grid.Column="1"
                        FontAttributes="Bold"
                        FontSize="25"
                        HorizontalOptions="Center"
                        Text="EGRESOS"
                        TextColor="Black"
                        VerticalOptions="Center" />

                    <Label
                        Grid.Row="0"
                        Grid.Column="2"
                        Margin="10,0,0,0"
                        FontAttributes="Bold"
                        FontSize="25"
                        HorizontalOptions="Center"
                        Text="INGRESOS"
                        TextColor="Black"
                        VerticalOptions="Center" />


                    <!--  Egresos  -->
                    <VerticalStackLayout Grid.Row="1" Grid.Column="1">

                        <HorizontalStackLayout>
                            <Button
                                Command="{Binding CrearEgresoCommand}"
                                HeightRequest="70"
                                HorizontalOptions="Center"
                                VerticalOptions="Center"
                                WidthRequest="90">
                                <Button.ImageSource>
                                    <FontImageSource
                                        FontFamily="FASolid"
                                        Glyph="{x:Static fa:Solid.CirclePlus}"
                                        Size="38"
                                        Color="#53D681" />
                                </Button.ImageSource>
                            </Button>
                            <Button
                                Command="{Binding ModificarEgresoCommand}"
                                StyleClass="OutlinedButton"
                                Text="Modificar Egreso"
                                WidthRequest="180" />

                            <Label
                                Margin="15,0,15,0"
                                FontAttributes="Bold"
                                FontSize="13"
                                Text="{Binding TotalEgresos, StringFormat='Total Egresos: ${0:N2}'}"
                                TextColor="Black"
                                VerticalOptions="Center" />

                            <Label
                                Margin="0,0,15,0"
                                FontAttributes="Bold"
                                FontSize="13"
                                Text="{Binding TotalEgresosIva, StringFormat='Total IVA: ${0:N2}'}"
                                TextColor="Black"
                                VerticalOptions="Center" />

                        </HorizontalStackLayout>


                        <dg:DataGrid
                            Padding="0,0,5,0"
                            IsRefreshing="{Binding IsBusy}"
                            ItemsSource="{Binding ListEgresos}"
                            PaginationEnabled="False"
                            RowHeight="50"
                            SelectedItem="{Binding EgresoSeleccionado, Mode=TwoWay}"
                            SelectionMode="Single"
                            Style="{StaticResource TablaComun}">

                            <dg:DataGrid.Columns>

                                <dg:DataGridColumn
                                    Title="Fecha"
                                    Width="70"
                                    PropertyName="Fecha"
                                    StringFormat="{}{0:dd-MM-yyyy}" />
                                <dg:DataGridColumn Title="Factura" PropertyName="Factura" />
                                <dg:DataGridColumn Title="Descripción" PropertyName="DescripEgreso" />

                                <dg:DataGridColumn Title="Monto">
                                    <dg:DataGridColumn.CellTemplate>
                                        <DataTemplate x:DataType="models:Egreso">
                                            <Label
                                                FontSize="12"
                                                HorizontalOptions="Center"
                                                Text="{Binding Monto, StringFormat='${0:N2}'}"
                                                VerticalOptions="Center"
                                                VerticalTextAlignment="Center" />
                                        </DataTemplate>
                                    </dg:DataGridColumn.CellTemplate>
                                </dg:DataGridColumn>

                                <dg:DataGridColumn Title="IVA">
                                    <dg:DataGridColumn.CellTemplate>
                                        <DataTemplate x:DataType="models:Egreso">
                                            <Label
                                                FontSize="12"
                                                HorizontalOptions="Center"
                                                Text="{Binding SumaIva, StringFormat='${0:N2}'}"
                                                VerticalOptions="Center"
                                                VerticalTextAlignment="Center" />
                                        </DataTemplate>
                                    </dg:DataGridColumn.CellTemplate>
                                </dg:DataGridColumn>

                                <dg:DataGridColumn Title="Comentario" PropertyName="Comentario" />

                            </dg:DataGrid.Columns>


                        </dg:DataGrid>

                        <Border
                            Margin="0,20,0,0"
                            Padding="7"
                            BackgroundColor="White"
                            HorizontalOptions="End"
                            Stroke="#E0E0E0"
                            StrokeShape="16">
                            <HorizontalStackLayout VerticalOptions="Center">

                                <Label
                                    Margin="0,0,5,0"
                                    Text="Copiar egresos al mes:"
                                    VerticalTextAlignment="Center" />



                                <material:PickerField
                                    Title="Mes"
                                    x:DataType="{x:Null}"
                                    AllowClear="False"
                                    BorderColor="#C9C9C9"
                                    BorderThickness="1"
                                    FontSize="12"
                                    HeightRequest="60"
                                    ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type viewModels:IngresoEgresoViewModel}}, Path=MesesCopy}"
                                    SelectedIndex="{Binding MesToCopy, Mode=TwoWay}"
                                    WidthRequest="90" />

                                <material:PickerField
                                    Title="Año"
                                    x:DataType="{x:Null}"
                                    AllowClear="False"
                                    BorderColor="#C9C9C9"
                                    FontSize="12"
                                    HeightRequest="60"
                                    ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type viewModels:IngresoEgresoViewModel}}, Path=AñosCopy}"
                                    SelectedIndex="{Binding AñoToCopyIndex, Mode=TwoWay}"
                                    WidthRequest="100" />

                                <ImageButton
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:IngresoEgresoViewModel}}, Path=CopiarEgresosCommand}"
                                    CommandParameter="{Binding .}"
                                    HorizontalOptions="End"
                                    StyleClass="OutlinedButton"
                                    VerticalOptions="Center">
                                    <ImageButton.Source>
                                        <FontImageSource
                                            FontFamily="FASolid"
                                            Glyph="{x:Static fa:Solid.ShareFromSquare}"
                                            Size="17"
                                            Color="#B5B28E" />
                                    </ImageButton.Source>
                                </ImageButton>

                            </HorizontalStackLayout>

                        </Border>




                    </VerticalStackLayout>


                    <!--  Ingresos  -->
                    <VerticalStackLayout Grid.Row="1" Grid.Column="2">

                        <HorizontalStackLayout Margin="15,0,0,0">
                            <Button
                                Command="{Binding CrearIngresoCommand}"
                                HeightRequest="70"
                                HorizontalOptions="Center"
                                VerticalOptions="Center"
                                WidthRequest="90">
                                <Button.ImageSource>
                                    <FontImageSource
                                        FontFamily="FASolid"
                                        Glyph="{x:Static fa:Solid.CirclePlus}"
                                        Size="38"
                                        Color="#53D681" />
                                </Button.ImageSource>
                            </Button>
                            <Button
                                Command="{Binding ModificarIngresoCommand}"
                                StyleClass="OutlinedButton"
                                Text="Modificar Ingreso"
                                WidthRequest="180" />


                            <Label
                                Margin="15,0,15,0"
                                FontAttributes="Bold"
                                FontSize="13"
                                Text="{Binding TotalIngresos, StringFormat='Total Ingresos: ${0:N2}'}"
                                TextColor="Black"
                                VerticalOptions="Center" />

                            <Label
                                Margin="0,0,15,0"
                                FontAttributes="Bold"
                                FontSize="13"
                                Text="{Binding TotalIngresosIva, StringFormat='Total IVA: ${0:N2}'}"
                                TextColor="Black"
                                VerticalOptions="Center" />

                        </HorizontalStackLayout>

                        <dg:DataGrid
                            Padding="15,0,0,0"
                            IsRefreshing="{Binding IsBusy}"
                            ItemsSource="{Binding ListIngresos}"
                            PaginationEnabled="False"
                            RowHeight="50"
                            SelectedItem="{Binding IngresoSeleccionado, Mode=TwoWay}"
                            SelectionMode="Single"
                            Style="{StaticResource TablaComun}">

                            <dg:DataGrid.Columns>



                                <dg:DataGridColumn
                                    Title="Fecha"
                                    Width="70"
                                    PropertyName="Fecha"
                                    StringFormat="{}{0:dd-MM-yyyy}" />
                                <dg:DataGridColumn Title="OP" PropertyName="Op" />
                                <dg:DataGridColumn Title="Remito" PropertyName="Remito" />
                                <dg:DataGridColumn Title="Factura" PropertyName="Factura" />
                                <dg:DataGridColumn
                                    Title="Descripción"
                                    Width="1.5*"
                                    PropertyName="DescripIngreso" />

                                <dg:DataGridColumn Title="Monto">
                                    <dg:DataGridColumn.CellTemplate>
                                        <DataTemplate x:DataType="models:Ingreso">
                                            <Label
                                                FontSize="12"
                                                HorizontalOptions="Center"
                                                Text="{Binding Monto, StringFormat='${0:N2}'}"
                                                VerticalOptions="Center"
                                                VerticalTextAlignment="Center" />
                                        </DataTemplate>
                                    </dg:DataGridColumn.CellTemplate>
                                </dg:DataGridColumn>

                                <dg:DataGridColumn Title="Comentario">
                                    <dg:DataGridColumn.CellTemplate>
                                        <DataTemplate x:DataType="models:Ingreso">
                                            <Label
                                                FontSize="12"
                                                HorizontalOptions="Center"
                                                Text="{Binding Comentario}"
                                                VerticalOptions="Center"
                                                VerticalTextAlignment="Center" />
                                        </DataTemplate>
                                    </dg:DataGridColumn.CellTemplate>
                                </dg:DataGridColumn>


                            </dg:DataGrid.Columns>


                        </dg:DataGrid>
                    </VerticalStackLayout>









                </Grid>
            </Grid>
        </ScrollView>

    </Grid>




</ContentPage>