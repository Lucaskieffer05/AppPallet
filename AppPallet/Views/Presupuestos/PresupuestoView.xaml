<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AppPallet.Views.PresupuestoView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:fa="clr-namespace:UraniumUI.Icons.FontAwesome;assembly=UraniumUI.Icons.FontAwesome"
    xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
    xmlns:models="clr-namespace:AppPallet.Models"
    xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
    xmlns:viewModels="clr-namespace:AppPallet.ViewModels"
    Title="PresupuestoView"
    x:DataType="viewModels:PresupuestoViewModel"
    Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,*,Auto">
        <!--  Header  -->
        <Border
            Grid.Row="0"
            BackgroundColor="#374151"
            HeightRequest="70"
            Stroke="Black">
            <Grid Padding="20,0" ColumnDefinitions="*,Auto">
                <Label
                    Grid.Column="0"
                    FontAttributes="Bold"
                    FontSize="28"
                    HorizontalOptions="Start"
                    Text="PRESUPUESTOS"
                    TextColor="#F6F1EB"
                    VerticalOptions="Center" />
                <Button
                    Grid.Column="1"
                    Padding="25,12"
                    BackgroundColor="#F6F1EB"
                    BorderColor="#D0B595"
                    BorderWidth="2"
                    Command="{Binding CrearPresupuestoCommand}"
                    CornerRadius="25"
                    FontAttributes="Bold"
                    FontSize="15"
                    HeightRequest="50"
                    HorizontalOptions="End"
                    StyleClass="FilledButton"
                    Text="➕ Nuevo Presupuesto"
                    TextColor="Black"
                    WidthRequest="220" />
            </Grid>
        </Border>

        <!--  Content  -->
        <ScrollView Grid.Row="1" Padding="10">
            <VerticalStackLayout>
                <ActivityIndicator
                    HorizontalOptions="Center"
                    IsRunning="{Binding IsBusy}"
                    IsVisible="{Binding IsBusy}"
                    VerticalOptions="Center" />

                <FlexLayout
                    AlignItems="Start"
                    BindableLayout.ItemsSource="{Binding ListaEmpresas}"
                    Direction="Row"
                    JustifyContent="Start"
                    Wrap="Wrap">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:Empresa">
                            <Border
                                Margin="6"
                                Padding="0"
                                BackgroundColor="White"
                                HeightRequest="280"
                                Stroke="#E5E7EB"
                                StrokeThickness="1"
                                WidthRequest="420">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16" />
                                </Border.StrokeShape>

                                <Grid RowDefinitions="Auto,*,Auto">
                                    <!--  Header con gradiente  -->
                                    <Border
                                        Grid.Row="0"
                                        BackgroundColor="#D0B595"
                                        HeightRequest="90">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="16,16,0,0" />
                                        </Border.StrokeShape>
                                        <Grid Padding="20,15" RowDefinitions="Auto,Auto">
                                            <Label
                                                Grid.Row="0"
                                                FontAttributes="Bold"
                                                FontSize="20"
                                                Text="{Binding NomEmpresa}"
                                                TextColor="White" />
                                            <Label
                                                Grid.Row="1"
                                                Margin="0,5,0,0"
                                                FontSize="13"
                                                Text="{Binding Cuit}"
                                                TextColor="#F5F5F5" />
                                        </Grid>
                                    </Border>

                                    <!--  Contenido de presupuestos  -->
                                    <VerticalStackLayout
                                        Grid.Row="1"
                                        Padding="20,15"
                                        Spacing="8">
                                        <Label
                                            Margin="0,0,0,5"
                                            FontAttributes="Bold"
                                            FontSize="14"
                                            HorizontalTextAlignment="Center"
                                            Text="Presupuestos del Mes Actual"
                                            TextColor="#6B7280" />

                                        <CollectionView
                                            Margin="0,5,0,0"
                                            ItemsSource="{Binding CostoPorPallet}"
                                            MaximumHeightRequest="140">
                                            <CollectionView.ItemsLayout>
                                                <LinearItemsLayout ItemSpacing="2" Orientation="Vertical" />
                                            </CollectionView.ItemsLayout>
                                            <CollectionView.ItemTemplate>
                                                <DataTemplate x:DataType="models:CostoPorPallet">
                                                    <Border
                                                        Padding="11,8"
                                                        BackgroundColor="#F9FAFB"
                                                        Stroke="#E5E7EB"
                                                        StrokeThickness="1">
                                                        <Border.StrokeShape>
                                                            <RoundRectangle CornerRadius="8" />
                                                        </Border.StrokeShape>
                                                        <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                                                            <Label
                                                                Grid.Column="0"
                                                                FontAttributes="Bold"
                                                                FontSize="14"
                                                                Text="{Binding NombrePalletCliente}"
                                                                TextColor="#1F2937"
                                                                VerticalOptions="Center" />
                                                            <HorizontalStackLayout
                                                                Grid.Column="1"
                                                                Spacing="5"
                                                                VerticalOptions="Center">
                                                                <Label
                                                                    FontSize="12"
                                                                    Text="Precio:"
                                                                    TextColor="#6B7280" />
                                                                <Label
                                                                    FontAttributes="Bold"
                                                                    FontSize="13"
                                                                    Text="{Binding PrecioPallet, StringFormat='${0:N0}'}"
                                                                    TextColor="#059669" />
                                                            </HorizontalStackLayout>
                                                            <HorizontalStackLayout
                                                                Grid.Column="2"
                                                                Spacing="5"
                                                                VerticalOptions="Center">
                                                                <Label
                                                                    FontSize="12"
                                                                    Text="Ganancia:"
                                                                    TextColor="#6B7280" />
                                                                <Label
                                                                    FontAttributes="Bold"
                                                                    FontSize="13"
                                                                    Text="{Binding GananciaPorCantPallet, StringFormat='${0:N0}'}"
                                                                    TextColor="#DC2626" />
                                                            </HorizontalStackLayout>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </CollectionView.ItemTemplate>
                                        </CollectionView>
                                    </VerticalStackLayout>

                                    <!--  Footer con botón  -->
                                    <Border
                                        Grid.Row="2"
                                        BackgroundColor="#F9FAFB"
                                        HeightRequest="50">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="0,0,16,16" />
                                        </Border.StrokeShape>
                                        <Button
                                            Margin="0,0,15,0"
                                            BackgroundColor="Transparent"
                                            BorderColor="#D0B595"
                                            BorderWidth="1"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:PresupuestoViewModel}}, Path=MostrarPresupuestoCommand}"
                                            CommandParameter="{Binding EmpresaId}"
                                            CornerRadius="8"
                                            FontAttributes="Bold"
                                            FontSize="14"
                                            HeightRequest="36"
                                            HorizontalOptions="End"
                                            Text="Ver Detalles →"
                                            TextColor="#D0B595"
                                            WidthRequest="140" />
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
