<?xml version="1.0" encoding="utf-8" ?>
<uranium:UraniumContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                            x:Class="AppPallet.Views.VentaView"
                            Title="Gestión de Ventas"
                            xmlns:viewModels="clr-namespace:AppPallet.ViewModels"
                            xmlns:models="clr-namespace:AppPallet.Models"
                            xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
                            xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
                            xmlns:fa="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/fontawesome"
                            xmlns:converters="clr-namespace:AppPallet.Converters"
                            x:DataType="viewModels:VentaViewModel">

    <uranium:UraniumContentPage.Resources>
        <ResourceDictionary>
            <converters:EstadoVentaToColorConverter x:Key="EstadoVentaToColor" />

            <Style x:Key="HeaderLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HorizontalOptions" Value="Center" />
                <Setter Property="Margin" Value="0,10,0,20" />
            </Style>

            <Style x:Key="CardStyle" TargetType="Border">
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="Stroke" Value="#E0E0E0" />
                <Setter Property="Background" Value="White" />
                <Setter Property="StrokeShape" Value="RoundRectangle 12" />
                <Setter Property="Padding" Value="15" />
                <Setter Property="Margin" Value="10,5" />
            </Style>

            <Style x:Key="ActionButtonStyle" TargetType="Button">
                <Setter Property="HeightRequest" Value="45" />
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Margin" Value="5" />
            </Style>

        </ResourceDictionary>
    </uranium:UraniumContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="10" Padding="15">

        <!-- Encabezado -->
        <HorizontalStackLayout Grid.Row="0" HorizontalOptions="Center">
            <Image Source="graficodebarras.png" HeightRequest="30" WidthRequest="30" VerticalOptions="Center"/>
            <Label Text="Panel de Ventas" Style="{StaticResource HeaderLabelStyle}" Margin="8,0,0,0"/>
        </HorizontalStackLayout>

        <!-- Indicadores de Estado -->
        <Border  Grid.Row="1" BackgroundColor="#F8F9FA" Style="{StaticResource CardStyle}" >
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="15">
                <Border Grid.Column="0"  Stroke="#4CAF50" BackgroundColor="#E8F5E8">
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="2">
                        <Label Text="✅" FontSize="16" HorizontalOptions="Center"/>
                        <Label Text="Activas" TextColor="#2E7D32" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border Grid.Column="1"  Stroke="#F44336" BackgroundColor="#FFEBEE">
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="2">
                        <Label Text="❌" FontSize="16" HorizontalOptions="Center"/>
                        <Label Text="Pendientes" TextColor="#C62828" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border Grid.Column="2" Stroke="#607D8B" BackgroundColor="#ECEFF1">
                    <Button Text="➕ Agregar Nueva Venta" 
                            Command="{Binding CrearVentaCommand}" 
                            BackgroundColor="#4CAF50" TextColor="White"
                            WidthRequest="210"/>
                </Border>
            </Grid>
        </Border>


        <!-- Lista de Ventas -->
        <Border Grid.Row="2" BackgroundColor="White" Style="{StaticResource CardStyle}">
            <VerticalStackLayout Spacing="10">

                <!-- cosas extras -->
                <Label Text="Lista de Ventas" FontSize="20" FontAttributes="Bold" Margin="0,0,0,10"/>

                <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" HorizontalOptions="Center"/>


                <Grid ColumnDefinitions="2*,1*,1*,2*,1*,1*,2*,2*,1*" ColumnSpacing="8">
                    <Label Grid.Column="0" Text="Fecha de Venta" VerticalOptions="Center" FontSize="16" TextColor="#BDBDBD"/>
                    <Label Grid.Column="1" Text="Empresa" VerticalOptions="Center" FontSize="16" TextColor="#BDBDBD"/>
                    <Label Grid.Column="2" Text="Cantidad Pallets"  VerticalOptions="Center" FontSize="16" TextColor="#BDBDBD" />
                    <Label Grid.Column="3" Text="Presupuesto" VerticalOptions="Center" FontSize="16" TextColor="#BDBDBD"/>
                    <Label Grid.Column="4" Text="Precio c/u" VerticalOptions="Center" FontSize="16" TextColor="#BDBDBD"/>
                    <Label Grid.Column="5" Text="Estado"  VerticalOptions="Center" FontSize="16" TextColor="#BDBDBD" />
                    <Label Grid.Column="6" Text="Comentario"  VerticalOptions="Center" FontSize="16" TextColor="#BDBDBD" />
                    <Label Grid.Column="7" Text="Fecha de Entrega" VerticalOptions="Center" FontSize="16" TextColor="#BDBDBD"/>
                    <Label Grid.Column="8" Text="Acción" TextColor="#BDBDBD"/>
                </Grid>


                <!--Lista de las ventas-->
                <CollectionView ItemsSource="{Binding ListaVentas}" SelectionMode="Single" HeightRequest="500" SelectedItem="{Binding VentaSeleccionada, Mode=TwoWay}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Venta">


                            <Border Padding="10" Margin="5" Style="{StaticResource CardStyle}">


                                <Grid ColumnDefinitions="2*,1*,1*,2*,1*,1*,2*,2*,1*" ColumnSpacing="8">

                                    <HorizontalStackLayout Grid.Column="0" VerticalOptions="Center" Spacing="5">
                                        <Image Source="calendario.png" HeightRequest="18" WidthRequest="18" VerticalOptions="Center"/>
                                        <Label Text="{Binding FechaVenta, StringFormat='{0:dd/MM/yyyy}'}" FontSize="16" TextColor="#333" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                                    </HorizontalStackLayout>

                                    <Label Grid.Column="1" Text="{Binding CostoPorPallet.Empresa.NomEmpresa, StringFormat='{0}'}" 
                                            VerticalOptions="Center" FontSize="16" TextColor="#333"/>

                                    <HorizontalStackLayout Grid.Column="2" VerticalOptions="Center" Spacing="5">
                                        
                                        <Label Text="{Binding CantPallets}" VerticalOptions="Center" FontSize="16" TextColor="#333"/>
                                        <Image Source="pallet.png" HeightRequest="15" WidthRequest="15" VerticalOptions="Center"/>
                                        
                                    </HorizontalStackLayout>

                                    <Label Grid.Column="3" Text="{Binding CostoPorPallet.NombrePalletCliente, StringFormat='{0}'}" 
                                            VerticalOptions="Center" FontSize="16" TextColor="#333"/>

                                    <Label Grid.Column="4" Text="{Binding CostoPorPallet.PrecioPallet, StringFormat='${0:N2}'}" 
                                           VerticalOptions="Center" FontSize="16" TextColor="#333"/>

                                    <Label Grid.Column="5" Text="{Binding Estado}" 
                                           TextColor="{Binding Estado, Converter={StaticResource EstadoVentaToColor}}" 
                                           VerticalOptions="Center" FontSize="16" FontAttributes="Bold"/>
                                    
                                    <Label Grid.Column="6" Text="{Binding Comentario, StringFormat='{0}'}" 
                                           VerticalOptions="Center" FontSize="16" TextColor="#333"/>

                                    <HorizontalStackLayout Grid.Column="7" VerticalOptions="Center" Spacing="5">
                                        <Image Source="cajadeentrega.png" HeightRequest="20" WidthRequest="20" VerticalOptions="Center"/>
                                        <Label Text="{Binding FechaEntrega, StringFormat='{0:dd/MM/yyyy}'}" FontSize="16" TextColor="#333"/>
                                    </HorizontalStackLayout>

                                    <Button Grid.Column="8" Text="✏️ Editar" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:VentaViewModel}}, Path=ModificarVentaCommand}" 
                                            CommandParameter="{Binding VentaId}" BackgroundColor="#2196F3" TextColor="White"
                                            Style="{StaticResource ActionButtonStyle}"/>
                                
                                </Grid>
                                
                                
                            </Border>
                            
                            
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </Border>


        <!-- Panel de Acciones -->
        <!-- 
        <Border Style="{StaticResource CardStyle}" Grid.Row="3" BackgroundColor="#F3F4F6">
            <VerticalStackLayout>
                <Label Text="Acciones" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center" Padding="0,0,0,15"/>
                <HorizontalStackLayout Spacing="15" HorizontalOptions="Center" VerticalOptions="Center">
                    

                    

                    <Button Text="✏️ Modificar Venta Seleccionada" 
                            Command="{Binding ModificarVentaCommand}" 
                            CommandParameter="{Binding VentaSeleccionada.VentaId}"
                            Style="{StaticResource ActionButtonStyle}"
                            BackgroundColor="#FF9800" TextColor="White"
                            WidthRequest="200"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>
        -->

    </Grid>
</uranium:UraniumContentPage>