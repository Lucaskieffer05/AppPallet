<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AppPallet.Views.GastosFijosView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:dg="clr-namespace:Maui.DataGrid;assembly=Maui.DataGrid"
    xmlns:fa="clr-namespace:UraniumUI.Icons.FontAwesome;assembly=UraniumUI.Icons.FontAwesome"
    xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
    xmlns:models="clr-namespace:AppPallet.Models"
    xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
    xmlns:viewModels="clr-namespace:AppPallet.ViewModels"
    Title="Gastos Fijos"
    x:DataType="viewModels:GastosFijosViewModel"
    Shell.NavBarIsVisible="False">


    <Grid RowDefinitions="Auto,*">

        <!--  Header  -->
        <Border Grid.Row="0" Stroke="Black">
            <Grid BackgroundColor="#374151" ColumnDefinitions="0.3*,Auto,Auto,0.1*">

                <Label
                    Grid.Column="0"
                    Margin="10,0,0,0"
                    FontAttributes="Bold"
                    FontSize="25"
                    HorizontalOptions="Start"
                    Text="GASTOS FIJOS"
                    TextColor="#F6F1EB"
                    VerticalOptions="Center" />

                <HorizontalStackLayout Grid.Column="1" HorizontalOptions="Center">
                    <Label
                        FontSize="15"
                        Text="Filtrar por mes:"
                        TextColor="White"
                        VerticalOptions="Center" />

                    <material:PickerField
                        x:Name="MesPicker"
                        Padding="5"
                        AccentColor="White"
                        BorderColor="White"
                        InputBackgroundColor="#F6F1EB"
                        ItemsSource="{Binding Meses}"
                        SelectedIndex="{Binding MesIngresado, Mode=TwoWay}"
                        TextColor="White" />

                    <material:PickerField
                        x:Name="AñoPicker"
                        Padding="5"
                        AccentColor="White"
                        BorderColor="White"
                        InputBackgroundColor="#F6F1EB"
                        ItemsSource="{Binding Años}"
                        SelectedItem="{Binding AñoIngresado, Mode=TwoWay}"
                        TextColor="White" />



                </HorizontalStackLayout>
                <Button
                    Grid.Column="2"
                    Margin="400,0,0,0"
                    Padding="20,10"
                    BackgroundColor="#F6F1EB"
                    BorderColor="#D0B595"
                    BorderWidth="3"
                    Command="{Binding MostrarPopupGastoFijoCommand}"
                    CornerRadius="20"
                    HeightRequest="45"
                    StyleClass="FilledButton"
                    Text="Agregar Gasto Fijo"
                    TextColor="Black"
                    WidthRequest="200" />
            </Grid>
        </Border>


        <!--  Gastos fijos  -->

        <Grid Grid.Row="1" RowDefinitions="50,*">

            <HorizontalStackLayout
                Grid.Row="0"
                HorizontalOptions="Center"
                Spacing="10">
                <Label
                    FontSize="17"
                    Text="Total de gasto fijos:"
                    TextColor="Gray"
                    VerticalOptions="Center" />
                <Label
                    FontAttributes="Bold"
                    FontSize="17"
                    Text="{Binding TotalGastosFijos, StringFormat='${0:N2}'}"
                    TextColor="Black"
                    VerticalOptions="Center" />
            </HorizontalStackLayout>

            <Grid Grid.Row="1" ColumnDefinitions="0.5*,*,0.5*">



                <Border
                    Grid.Column="1"
                    Stroke="Silver"
                    StrokeThickness="3"
                    VerticalOptions="Start">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10" />
                    </Border.StrokeShape>


                    <dg:DataGrid
                        BorderColor="Transparent"
                        IsRefreshing="{Binding IsBusy}"
                        ItemsSource="{Binding ListaGastosFijos}"
                        PaginationEnabled="False"
                        SelectedItem="{Binding GastoFijoSeleccionado, Mode=TwoWay}"
                        SelectionMode="Single"
                        Style="{StaticResource TablaComun}">

                        <dg:DataGrid.Columns>


                            <dg:DataGridColumn Title="Nombre del Gasto" PropertyName="NombreGastoFijo" />

                            <dg:DataGridColumn Title="Monto">
                                <dg:DataGridColumn.CellTemplate>
                                    <DataTemplate x:DataType="models:GastosFijos">
                                        <Label
                                            HorizontalOptions="Center"
                                            Text="{Binding Monto, StringFormat='${0:N2}'}"
                                            VerticalOptions="Center"
                                            VerticalTextAlignment="Center" />
                                    </DataTemplate>
                                </dg:DataGridColumn.CellTemplate>
                            </dg:DataGridColumn>

                            <dg:DataGridColumn Title="Fecha del Gasto">
                                <dg:DataGridColumn.CellTemplate>
                                    <DataTemplate x:DataType="models:GastosFijos">
                                        <Label
                                            HorizontalOptions="Center"
                                            Text="{Binding Mes, StringFormat='{0:MMMM - yyyy}'}"
                                            VerticalOptions="Center" />
                                    </DataTemplate>
                                </dg:DataGridColumn.CellTemplate>
                            </dg:DataGridColumn>

                        </dg:DataGrid.Columns>

                    </dg:DataGrid>
                </Border>


                <VerticalStackLayout
                    Grid.Column="2"
                    Spacing="20"
                    VerticalOptions="Center">



                    <Button
                        Background="#374151"
                        BorderColor="Black"
                        Command="{Binding MostrarPopupModificarGastoFijoCommand}"
                        StyleClass="FilledButton"
                        Text="Modificar Gasto Fijo"
                        WidthRequest="180" />

                    <HorizontalStackLayout HorizontalOptions="Center">
                        <material:PickerField
                            Title="Mes"
                            x:DataType="{x:Null}"
                            AllowClear="False"
                            BorderColor="#C9C9C9"
                            BorderThickness="1"
                            FontSize="12"
                            HeightRequest="60"
                            ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type viewModels:GastosFijosViewModel}}, Path=MesesCopy}"
                            SelectedIndex="{Binding MesToCopy, Mode=TwoWay}"
                            WidthRequest="90" />

                        <material:PickerField
                            Title="Año"
                            x:DataType="{x:Null}"
                            AllowClear="False"
                            BorderColor="#C9C9C9"
                            FontSize="12"
                            HeightRequest="60"
                            ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type viewModels:GastosFijosViewModel}}, Path=AñosCopy}"
                            SelectedIndex="{Binding AñoToCopyIndex, Mode=TwoWay}"
                            WidthRequest="100" />

                        <ImageButton
                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:GastosFijosViewModel}}, Path=CopiarGastosFijosCommand}"
                            CommandParameter="{Binding .}"
                            HorizontalOptions="End"
                            StyleClass="OutlinedButton"
                            VerticalOptions="Center">
                            <ImageButton.Source>
                                <FontImageSource
                                    FontFamily="FASolid"
                                    Glyph="{x:Static fa:Solid.ShareFromSquare}"
                                    Size="17"
                                    Color="#B5B28E" />
                            </ImageButton.Source>
                        </ImageButton>

                    </HorizontalStackLayout>


                </VerticalStackLayout>

            </Grid>
        </Grid>
    </Grid>

</ContentPage>